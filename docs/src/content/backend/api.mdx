# API Reference

Documentation for all API routes in DynamicFolio CMS.

## Table of Contents
- [Overview](#overview)
- [Available Endpoints](#available-endpoints)
- [Health Check](#health-check)
- [Blog - Fetch Medium](#blog---fetch-medium)
- [Future Endpoints](#future-endpoints)
- [Error Handling](#error-handling)

---

## Overview

DynamicFolio CMS uses Next.js App Router API routes. Currently, the application has minimal API endpoints as most data is managed client-side via Zustand stores with localStorage persistence.

### Base URL

```
Development: http://localhost:3000/api
Production:  https://yourdomain.com/api
```

### Response Format

All API responses follow this structure:

```typescript
// Success Response
{
  "success": true,
  "data": { ... }
}

// Error Response
{
  "success": false,
  "error": "Error message",
  "message": "Detailed error description"
}
```

---

## Available Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/health` | Health check endpoint |
| `POST` | `/api/health` | Health check (alias) |
| `GET` | `/api/blog/fetch-medium` | Fetch Medium RSS feed posts |

---

## Health Check

Check API and database connectivity status.

### Endpoint

```
GET /api/health
POST /api/health
```

### Response

**Success (200)**:
```json
{
  "status": "ok",
  "data": [
    {
      "id": 1,
      "last_ping": "2024-01-15T10:30:00.000Z"
    }
  ]
}
```

**Error (500)**:
```json
{
  "error": "Database connection failed"
}
```

### Usage

```typescript
// Frontend health check
async function checkHealth() {
  try {
    const response = await fetch('/api/health');
    const data = await response.json();
    
    if (data.status === 'ok') {
      console.log('API is healthy');
    }
  } catch (error) {
    console.error('Health check failed:', error);
  }
}
```

### Notes

- Updates `health_check` table in Supabase with current timestamp
- Requires Supabase configuration to be set up
- Used for uptime monitoring services

---

## GET /api/blog/fetch-medium

Fetch blog posts from a Medium RSS feed.

**Parameters:**
| Name | Type | Required | Description |
|------|------|----------|-------------|
| username | string | No | Medium username (default: `0xPranshu`) |
| limit | number | No | Max posts (default: `5`) |

**Response:**
- `200`: Success with posts array
- `500`: Failed to fetch

**Example:**
```json
// GET /api/blog/fetch-medium?username=0xPranshu&limit=2
{
  "success": true,
  "posts": [
    {
      "id": "...",
      "title": "Post Title",
      "url": "..."
    }
  ]
}
```

### Notes
- Uses `rss-parser` to parse Medium's RSS feed.
- Extracts clean text excerpt (max 200 chars).

---

## Future Endpoints

When migrating to full database backend, the following endpoints are planned:

### Projects API

```
GET    /api/projects          - List all projects
GET    /api/projects/:id      - Get single project
POST   /api/projects          - Create project
PATCH  /api/projects/:id      - Update project
DELETE /api/projects/:id      - Delete project
```

### Blog Posts API

```
GET    /api/posts             - List all posts
GET    /api/posts/:slug       - Get post by slug
POST   /api/posts             - Create post
PATCH  /api/posts/:id         - Update post
DELETE /api/posts/:id         - Delete post
```

### Skills API

```
GET    /api/skills            - List all skills
POST   /api/skills            - Create skill
PATCH  /api/skills/:id        - Update skill
DELETE /api/skills/:id        - Delete skill
```

### Authentication API

```
POST   /api/auth/login        - Login
POST   /api/auth/logout       - Logout
GET    /api/auth/session      - Get current session
POST   /api/auth/register     - Register (if enabled)
```

See [Database Setup](/backend/database) for database migration guide.

---

## Error Handling

### HTTP Status Codes

| Code | Meaning |
|------|---------|
| `200` | Success |
| `201` | Created |
| `400` | Bad Request - Invalid input |
| `401` | Unauthorized - Authentication required |
| `403` | Forbidden - Insufficient permissions |
| `404` | Not Found |
| `500` | Internal Server Error |

### Error Response Structure

```typescript
interface ErrorResponse {
  success: false;
  error: string;      // Human-readable error message
  message?: string;   // Detailed error description
  code?: string;      // Error code for programmatic handling
}
```

### Client-Side Error Handling

```typescript
async function apiRequest<T>(url: string, options?: RequestInit): Promise<T> {
  try {
    const response = await fetch(url, options);
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Request failed');
    }
    
    return data;
  } catch (error) {
    console.error('API Error:', error);
    throw error;
  }
}
```

---

## Creating New API Routes

### File Structure

```
src/app/api/
└── [endpoint]/
    └── route.ts      # Route handler
```

### Template

```typescript
// src/app/api/example/route.ts
import { NextRequest, NextResponse } from 'next/server';

export async function GET(request: NextRequest) {
  try {
    // Your logic here
    const data = { message: 'Hello' };
    
    return NextResponse.json({
      success: true,
      data,
    });
  } catch (error) {
    console.error('API Error:', error);
    
    return NextResponse.json(
      {
        success: false,
        error: 'Internal server error',
        message: error instanceof Error ? error.message : 'Unknown error',
      },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    
    // Validate input
    if (!body.requiredField) {
      return NextResponse.json(
        { success: false, error: 'Missing required field' },
        { status: 400 }
      );
    }
    
    // Your logic here
    
    return NextResponse.json({
      success: true,
      data: { id: 'new-id' },
    });
  } catch (error) {
    return NextResponse.json(
      { success: false, error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

### Dynamic Routes

```typescript
// src/app/api/projects/[id]/route.ts
import { NextRequest, NextResponse } from 'next/server';

type Context = { params: { id: string } };

export async function GET(
  request: NextRequest,
  context: Context
) {
  const { id } = await context.params;
  
  // Fetch project by id
  // ...
}
```

---

## Rate Limiting (Future)

When implementing production APIs, add rate limiting:

```typescript
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, '10 s'), // 10 requests per 10 seconds
});

export async function GET(request: NextRequest) {
  const ip = request.ip ?? '127.0.0.1';
  const { success } = await ratelimit.limit(ip);
  
  if (!success) {
    return NextResponse.json(
      { error: 'Too many requests' },
      { status: 429 }
    );
  }
  
  // Continue with request...
}
```

---

## Additional Resources

- [Next.js Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
- [Database Migration Guide](/backend/database)
- [Deployment Guide](/build-and-test/deployment)
